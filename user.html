<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASML Trader</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f7f9; text-align: center; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .price { font-size: 2.5rem; color: #0061af; font-weight: bold; }
        .btn { width: 100%; padding: 15px; margin: 10px 0; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-buy { background: #2ecc71; color: white; }
        .btn-sell { background: #e74c3c; color: white; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        #status { font-weight: bold; margin-bottom: 10px; }
        input { width: 100%; padding: 10px; margin-bottom: 10px; box-sizing: border-box; }
    </style>
</head>
<body>
    <div id="join-section">
        <input type="text" id="name-in" placeholder="Enter Name">
        <button class="btn btn-buy" onclick="join()">Join Game</button>
    </div>

    <div id="game-section" style="display:none">
        <div id="status">Connecting...</div>
        <div class="card">
            <div>Day <span id="day-ui">1</span> / 5</div>
            <div class="price">‚Ç¨<span id="price-ui">600</span></div>
        </div>
        <div class="card">
            <p>Cash: ‚Ç¨<span id="cash-ui">2000</span></p>
            <p>Shares: <span id="shares-ui">0</span></p>
        </div>
        <button id="b-btn" class="btn btn-buy" onclick="trade(1)">BUY 1</button>
        <button id="s-btn" class="btn btn-sell" onclick="trade(-1)">SELL 1</button>
    </div>

    <script>
        let myData = { id: '', cash: 2000, shares: 0 };
        let market = { price: 600, day: 1, isClosed: false };
        let conn = null;
        const peer = new Peer();
        const roomId = new URLSearchParams(window.location.search).get('room');

        function join() {
            myData.id = document.getElementById('name-in').value;
            if(!myData.id) return;
            document.getElementById('join-section').style.display = 'none';
            document.getElementById('game-section').style.display = 'block';
            
            conn = peer.connect(roomId);
            conn.on('data', (data) => {
                if(data.type === 'SYNC') {
                    market.price = data.price;
                    market.day = data.day;
                    market.isClosed = data.isClosed;
                    updateUI();
                }
            });
        }

        function trade(amt) {
            if(market.isClosed) return;
            const cost = amt * market.price;
            if(amt > 0 && myData.cash >= cost) {
                myData.cash -= cost; myData.shares += amt;
            } else if(amt < 0 && myData.shares >= Math.abs(amt)) {
                myData.cash += Math.abs(cost); myData.shares += amt;
            }
            updateUI();
            conn.send(myData);
        }

        function updateUI() {
            document.getElementById('day-ui').innerText = market.day;
            document.getElementById('price-ui').innerText = market.price;
            document.getElementById('cash-ui').innerText = myData.cash.toFixed(2);
            document.getElementById('shares-ui').innerText = myData.shares;
            
            if(market.isClosed) {
                document.getElementById('status').innerText = "üèÅ MARKET CLOSED";
                document.getElementById('status').style.color = "red";
                document.getElementById('b-btn').disabled = true;
                document.getElementById('s-btn').disabled = true;
            } else {
                document.getElementById('status').innerText = "üü¢ Market Open";
                document.getElementById('status').style.color = "green";
            }
        }
    </script>
</body>
</html>
